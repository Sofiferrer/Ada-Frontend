<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <title>Ejercicio 20</title>

     <!--
        
    1) Obtener lista de provincias de la api de Argentina en formato json():
    https://infra.datos.gob.ar/catalog/modernizacion/dataset/7/distribution/7.2/download/provincias.json
    // se puede  descargar y pegar directamente. 
        
    2) Armar un formulario que contenga: Nombre, Apellido, Provincia,Localidad, Edad.
    3)Las provincias deben estar precargas al cargar la pagina. Las provincias deben estar en un 
    select donde el se deben visualizar pero el valor debe ser su id.
    4) El Formulario debe contener un boton para agregar Nuevo Cliente
    5) La lista de nuevos clientes se debe mostrar en una tabla que se debe actualizar 
    cada vez que se agregue un cliente nuevo.
    6) La tabla debe permitir a traves de un boton ordenar los clientes por edad
    7) La tabla debe permitir a traves de un boton ordenar los clientes por provincia
    8) El nombre y id de la provincia se debe guardar en el array de nuevos clientes
    9) mostrar total de clientes debajo de la tabla.
    -->

  </head>
  <body onload="cargarProvincias();">
    
    <div class="container">      
            <div class="row">
                <div class="col-12 text-center text-primary p-3">
                    <h1>Lista de Clientes Nuevos</h1>
                </div>
                <div class="col-sm-6">
                  <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-primary">Formulario de Ingreso</h5>
                        <form class="" onsubmit="return false">
                            <div class="form-group">
                                <label for="idNombre">Nombre:</label>
                                <input required type="text" class="form-control" id="idNombre" minlength="1">
                            </div>
                            <div class="form-group">
                                <label for="idApellido">Apellido:</label>
                                <input required type="text" class="form-control" id="idApellido" >
                            </div>
                            <div class="form-group">
                                <label for="idEdad">Edad:</label>
                                <input required type="number" class="form-control" id="idEdad" >
                            </div>
                            <div class="form-group">
                                <label for="idProvincia">Provincia:</label>
                                <select required class="custom-select" id="idProvincia">
                                    <option selected value="0">Seleccione una Provicia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="idLocalidad">Localidad:</label>
                                <input required type="text" class="form-control" id="idLocalidad" >
                            </div>
    
                             <button type="submit" class="btn btn-primary" onclick="agregarCliente();">Agregar Nuevo Cliente</button>
                         </form>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5 class="card-title text-primary">Listado de Clientes</h5>
                      <button class="btn btn-primary mb-3" onclick="ordernarPorEdad();">Ordernar por Edad</button>
                      <button class="btn btn-primary mb-3" onclick="ordernarPorProvincia();">Ordernar por Provincia</button>
                      <table class="table table-stripped">
                        <thead class="">
                          <tr>
                            <th scope="col">Nombre</th>
                            <th scope="col">Apellido</th>
                            <th scope="col">Edad</th>
                            <th scope="col">Provincia</th>
                            <th scope="col">Localidad</th>
                          </tr>
                        </thead>
                        <tbody id="idTabla">
                          <tr>
                            <td>Lista vacía</td>
                          </tr>
                        </tbody>
                      </table>
                      <div id="idTotal">Total de Clientes: 0 </div>
                      
                    </div>
                  </div>
                </div>
            </div>

    </div>

    <script>
        var listaClientes = [];
        var totalClientes = 0;

        function cargarProvincias(){
            let json = JSON.parse('{"provincias":[{"nombre_completo":"Provincia de Misiones","fuente":"IGN","iso_id":"AR-N","nombre":"Misiones","id":"54","categoria":"Provincia","iso_nombre":"Misiones","centroide":{"lat":-26.8753965086829,"lon":-54.6516966230371}},{"nombre_completo":"Provincia de San Luis","fuente":"IGN","iso_id":"AR-D","nombre":"San Luis","id":"74","categoria":"Provincia","iso_nombre":"San Luis","centroide":{"lat":-33.7577257449137,"lon":-66.0281298195836}},{"nombre_completo":"Provincia de San Juan","fuente":"IGN","iso_id":"AR-J","nombre":"San Juan","id":"70","categoria":"Provincia","iso_nombre":"San Juan","centroide":{"lat":-30.8653679979618,"lon":-68.8894908486844}},{"nombre_completo":"Provincia de Entre Ríos","fuente":"IGN","iso_id":"AR-E","nombre":"Entre Ríos","id":"30","categoria":"Provincia","iso_nombre":"Entre Ríos","centroide":{"lat":-32.0588735436448,"lon":-59.2014475514635}},{"nombre_completo":"Provincia de Santa Cruz","fuente":"IGN","iso_id":"AR-Z","nombre":"Santa Cruz","id":"78","categoria":"Provincia","iso_nombre":"Santa Cruz","centroide":{"lat":-48.8154851827063,"lon":-69.9557621671973}},{"nombre_completo":"Provincia de Río Negro","fuente":"IGN","iso_id":"AR-R","nombre":"Río Negro","id":"62","categoria":"Provincia","iso_nombre":"Río Negro","centroide":{"lat":-40.4057957178801,"lon":-67.229329893694}},{"nombre_completo":"Provincia del Chubut","fuente":"IGN","iso_id":"AR-U","nombre":"Chubut","id":"26","categoria":"Provincia","iso_nombre":"Chubut","centroide":{"lat":-43.7886233529878,"lon":-68.5267593943345}},{"nombre_completo":"Provincia de Córdoba","fuente":"IGN","iso_id":"AR-X","nombre":"Córdoba","id":"14","categoria":"Provincia","iso_nombre":"Córdoba","centroide":{"lat":-32.142932663607,"lon":-63.8017532741662}},{"nombre_completo":"Provincia de Mendoza","fuente":"IGN","iso_id":"AR-M","nombre":"Mendoza","id":"50","categoria":"Provincia","iso_nombre":"Mendoza","centroide":{"lat":-34.6298873058957,"lon":-68.5831228183798}},{"nombre_completo":"Provincia de La Rioja","fuente":"IGN","iso_id":"AR-F","nombre":"La Rioja","id":"46","categoria":"Provincia","iso_nombre":"La Rioja","centroide":{"lat":-29.685776298315,"lon":-67.1817359694432}},{"nombre_completo":"Provincia de Catamarca","fuente":"IGN","iso_id":"AR-K","nombre":"Catamarca","id":"10","categoria":"Provincia","iso_nombre":"Catamarca","centroide":{"lat":-27.3358332810217,"lon":-66.9476824299928}},{"nombre_completo":"Provincia de La Pampa","fuente":"IGN","iso_id":"AR-L","nombre":"La Pampa","id":"42","categoria":"Provincia","iso_nombre":"La Pampa","centroide":{"lat":-37.1315537735949,"lon":-65.4466546606951}},{"nombre_completo":"Provincia de Santiago del Estero","fuente":"IGN","iso_id":"AR-G","nombre":"Santiago del Estero","id":"86","categoria":"Provincia","iso_nombre":"Santiago del Estero","centroide":{"lat":-27.7824116550944,"lon":-63.2523866568588}},{"nombre_completo":"Provincia de Corrientes","fuente":"IGN","iso_id":"AR-W","nombre":"Corrientes","id":"18","categoria":"Provincia","iso_nombre":"Corrientes","centroide":{"lat":-28.7743047046407,"lon":-57.8012191977913}},{"nombre_completo":"Provincia de Santa Fe","fuente":"IGN","iso_id":"AR-S","nombre":"Santa Fe","id":"82","categoria":"Provincia","iso_nombre":"Santa Fe","centroide":{"lat":-30.7069271588117,"lon":-60.9498369430241}},{"nombre_completo":"Provincia de Tucumán","fuente":"IGN","iso_id":"AR-T","nombre":"Tucumán","id":"90","categoria":"Provincia","iso_nombre":"Tucumán","centroide":{"lat":-26.9478001830786,"lon":-65.3647579441481}},{"nombre_completo":"Provincia del Neuquén","fuente":"IGN","iso_id":"AR-Q","nombre":"Neuquén","id":"58","categoria":"Provincia","iso_nombre":"Neuquén","centroide":{"lat":-38.6417575824599,"lon":-70.1185705180601}},{"nombre_completo":"Provincia de Salta","fuente":"IGN","iso_id":"AR-A","nombre":"Salta","id":"66","categoria":"Provincia","iso_nombre":"Salta","centroide":{"lat":-24.2991344492002,"lon":-64.8144629600627}},{"nombre_completo":"Provincia del Chaco","fuente":"IGN","iso_id":"AR-H","nombre":"Chaco","id":"22","categoria":"Provincia","iso_nombre":"Chaco","centroide":{"lat":-26.3864309061226,"lon":-60.7658307438603}},{"nombre_completo":"Provincia de Formosa","fuente":"IGN","iso_id":"AR-P","nombre":"Formosa","id":"34","categoria":"Provincia","iso_nombre":"Formosa","centroide":{"lat":-24.894972594871,"lon":-59.9324405800872}},{"nombre_completo":"Provincia de Jujuy","fuente":"IGN","iso_id":"AR-Y","nombre":"Jujuy","id":"38","categoria":"Provincia","iso_nombre":"Jujuy","centroide":{"lat":-23.3200784211351,"lon":-65.7642522180337}},{"nombre_completo":"Ciudad Autónoma de Buenos Aires","fuente":"IGN","iso_id":"AR-C","nombre":"Ciudad Autónoma de Buenos Aires","id":"02","categoria":"Ciudad Autónoma","iso_nombre":"Ciudad Autónoma de Buenos Aires","centroide":{"lat":-34.6144934119689,"lon":-58.4458563545429}},{"nombre_completo":"Provincia de Buenos Aires","fuente":"IGN","iso_id":"AR-B","nombre":"Buenos Aires","id":"06","categoria":"Provincia","iso_nombre":"Buenos Aires","centroide":{"lat":-36.6769415180527,"lon":-60.5588319815719}},{"nombre_completo":"Provincia de Tierra del Fuego, Antártida e Islas del Atlántico Sur","fuente":"IGN","iso_id":"AR-V","nombre":"Tierra del Fuego, Antártida e Islas del Atlántico Sur","id":"94","categoria":"Provincia","iso_nombre":"Tierra del Fuego","centroide":{"lat":-82.52151781221,"lon":-50.7427486049785}}],"total":24,"cantidad":24,"parametros":{},"inicio":0}');
            console.log(json);  
            
            let provincias = json.provincias;
            console.log(provincias);
            
            provincias.forEach(provincia =>{
                let opcion = "<option value='"+ provincia.id +"'>"+ provincia.nombre +"</option>";
                document.getElementById("idProvincia").insertAdjacentHTML("beforeend",opcion);
                console.log(opcion);
            });
        }


        function agregarCliente(){
            let nombre = document.getElementById("idNombre").value;
            let apellido = document.getElementById("idApellido").value;
            let edad = document.getElementById("idEdad").value;
            let seleccionProvincia = document.getElementById("idProvincia");
            let nombreProvincia = seleccionProvincia.options[seleccionProvincia.selectedIndex].text;
            let idProvincia = seleccionProvincia.options[seleccionProvincia.selectedIndex].value;
            let localidad = document.getElementById("idLocalidad").value;

            console.log(nombre.length); 

            if (nombre.length > 0 && apellido.length > 0 && edad.length > 0 && idProvincia != 0 && localidad.length > 0){
                totalClientes++;
                listaClientes[totalClientes] = [nombre,apellido,edad,nombreProvincia,idProvincia,localidad];
                console.log(listaClientes);
                imprimirLista();
            }
            else{
                alert("Hay un error en el ingreso de datos.")
            }
        }

        function imprimirLista(){
            let lista = "";

            listaClientes.forEach(cliente => {
                lista = lista + "<tr><td>" + cliente[0] + "</td>";
                lista = lista + "<td>" + cliente[1] + "</td>";
                lista = lista + "<td>" + cliente[2] + "</td>";
                lista = lista + "<td>" + cliente[3] + "</td>";
                lista = lista + "<td>" + cliente[5] + "</td></tr>";

            });

            // Imprimo la variable y limpio el input
            document.getElementById("idTabla").innerHTML = lista;
            document.getElementById("idTotal").innerHTML = "Total de Clientes: "+totalClientes;
        }

        function ordernarPorProvincia(){

            listaClients = listaClientes.sort(
                                function(a, b){
                                    if ( a[3] < b[3] ){
                                        return -1;
                                    }
                                    if ( a[3] > b[3] ){
                                        return 1;
                                    }
                                    return 0;
                                } 
                            );
         imprimirLista();

        }

        function ordernarPorEdad(){
            listaClients = listaClientes.sort(function(a, b){return a[2] - b[2]});
            imprimirLista();
        }

    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  </body>
</html>